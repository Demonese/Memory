# [Lua，一个被误解的语言](https://andregarzia.com/2021/01/lua-a-misunderstood-language.html)  
_发表于 2021年一月15日 星期五_  
_译者：[Demonese](https://github.com/Demonese)_  
  
　　Lua是我最喜欢的编程语言之一。我用它为我的旧教学网站建立了一个CMS，用于创建很酷的物联网硬件项目，用于创建小游戏，并试验网络去中心化。尽管如此，我并不认为自己是这方面的专家，我最多只是一个有能力的用户。也就是说，我在不同的环境中接触过它，并且接触了很多年，但我对它的实现或生态系统并没有深入了解。因此，当我读到关于Lua的博客和文章时，我感到有些不爽，因为它们似乎完全忽略了语言的目标和环境。通常，这些帖子读起来就像咆哮，或者是一系列的诉求。最近，我在LWN上看到了一篇[关于Lua缺乏 _电池_ ](https://lwn.net/Articles/812122/)的文章，在[Hacker News上](https://news.ycombinator.com/item?id=25794374)也看到了一篇让我很想回复的关于这篇文章的讨论。在这篇文章中，我将提出我在那篇原创文章和Hacker News上看到的一些评论。  
  
## Lua应该被视为一个工具箱  
  
　　我想是[Hisham在2017年LuaConf的演讲](https://hisham.hm/papers/talks/hisham-lap-luaconf2017.pdf)中说过Lua是简约的（也就是：“0种方法做到它”）。这当然是关于Lua提供机制而不是方针，或者它如何通过让开发者调整语言来适应他们的环境，而不是反之。Lua应该被视为一个基础成分，你可以添加任何你想添加的东西。如果你要做水果冰沙，Lua就是牛奶，你可以添加任何你需要的水果。  
　　想要 _电池_ 的人想要的是 _现成的充满观点的工具_ 。他们并不是在Lua希望存在的背景下看待Lua。这就像看着一艘船，抱怨它不会飞。它本来就不是用来飞行的。除非你把剩下的地方建起来，然后用它来做水上飞机。这取决于你，Lua并不在乎。  
　　Lua一直是一种用于编写应用程序脚本的语言。人们总是假设你会使用其他东西来构建特定于领域的代码，并在其中嵌入Lua引擎以使其更加灵活。你是否在制作游戏？你可以使用任何对游戏有意义的语言来构建整个引擎，包括只有你的游戏才关心的领域特定内容，然后添加Lua，这样你就可以无需重新编译源代码就可以编写和调整游戏。  
　　同样的环境也适用于其他提供Lua作为其插件或附加组件脚本语言的软件，这就是Lua被构建的目的，它为这种方法提供了优势。事实上，你可以用Lua编写整个软件，这是Lua是一门好语言的一个副作用，但它并不是它的主要用途。  
　　那些想要 _包含电池的Lua_ 的人没有意识到，有大量的 _包含电池的Lua_ 分发包在野外漂浮。其他开发人员选择了Lua，添加了他们认为很好的底线，并发布了一个完整的包。您也可以构建自己的 _包含电池的Lua_ ，它拥有您想要的东西。我们不需要来自PUC的Lua团队的祝福。它应该是这样用的。您可以挑选语言并组装所需的内容。  
　　这将带来健壮的软件，因为开发人员负责进行调用。你完全可以控制，可以做出适合自己开发的决定。在任何情况下，Lua团队或LuaRocks团队都不能阻止您做您想做的事情，就像在Elm社区内发生的戏剧一样。您可以获取您想要的版本的源代码，然后再也不用考虑Lua社区。  
　　我认为只有将Lua嵌入到自己的软件中，你才会欣赏它。除非您所构建的是其他语言（如C）和Lua中的某些代码的组合，否则Lua的强大功能不会为您带来好处。不仅Lua的能力，而且 _Lua的方式_ 也不会让你满意。如果您所使用的是100%的Lua源代码，那么它就像是另一种脚本语言——与Python或Ruby没有什么不同，并且您将开始尝试从其他语言的角度分析Lua，然而因为它们的目标不同，所以它们并不具有真正的可比性。  
  
## 对数组基于1的索引的抱怨  
  
　　在[这个评论](https://news.ycombinator.com/item?id=25795027)中提到。我经常看到一些人这样抱怨，他们认为C的方式才是唯一合理的方式。如果人们能花更多的时间思考为什么要使用基于0的索引，那就太好了。C使用这样的索引，是因为这个值实际上是一个乘数，可以用来查找数据位置的内存偏移量。如果您有一个数组，也就是一个指针指向内存中的数据的起始位置，你知道数组元素的大小，你可以将大小乘上索引，并加上指针的值，以获取与该索引引用的元素对应的数据。就是这样。索引是基于0的，帮助你在内存中找到东西，当你有一个指针的时候，这基本上是C给你的全部。  
　　当您像人类一样交谈时，使用1作为数组的初始位置是有意义的。当你和你的朋友在排队等候你的热狗时，你可能会对他们说你是第一个。我怀疑你会说你是第 _零_ 个，但我们通常从一开始数。当婴儿完成绕太阳的第一圈时，他们才一岁，而不是零岁。此外，当你在做迭代器时，基于1的索引也很有帮助，你不需要像 `i-1` 或计数直到 `i<total` 这样的技巧。你可以从1数到总数，就像一个正常人一样。如果我没记错的话，这是Pascal惯例。恕我直言，Pascal语言是一种非常值得热爱的语言。  
  
## 面向对象的抱怨  
  
　　Lua不是面向对象的，仅此而已。Lua的表（table）是一种非常灵活的数据结构。Lua有元表（metatable），这使得在使用表时具有更大的灵活性。它应该被视为一个工具箱（你能从这里看出一个主题吗？）。使用表和元表，您可以构建大量很酷的东西，比如命名空间和牛逼的OOP系统，都在你在控制之中。你想要建立一个像NewtonScript那样的具有双父类原型继承的系统吗？好吧，把它写出来。Lua提供的是机制，而不是方针。您可以使用这些机制来构建适合您的内容。您不需要依赖于PUC或库作者提供给您的内容。  
  
## 某些语言将取代Lua  
  
　　在[这个评论](https://news.ycombinator.com/item?id=25795027)中提到。请注意我不是排挤Janet，我真的很喜欢Janet。许多人没有意识到Lua是非常灵活的。Lua可以通过使用C89标准（即使默认是C99 IIRC）的编译器构建，对运行它的硬件几乎不做任何假设。这使得它成为硬件和应用程序内嵌入式工作的首选。许多被吹捧为Lua替代品的语言需要更多的资源，并对它们所运行的硬件和操作系统做更多的假设。尽管如此，Janet仍然非常棒（并且它使用C89 IIRC构建）。  
　　Lua非常小，我并不是说二进制大小和资源使用情况。我说的是源代码的复杂性。Lua非常小，新手开发者可以很好地理解它的内部结构并将其牢记于心。这使它成为学术研究的好语言。一门你容易理解的语言会促进你的实验。Lua特别适合用于研究和实践目的。  
  
## 结语  
  
　　最初我把这一节命名为 _结论_ ，但感觉不对。这是一篇关于Lua的文章，所以我不会给你一个结论，而是给你 _结语_ ——只是你工具箱中的另一个部分——以便你可以形成自己的结论。  
　　我不是计算机科学家。从1998年到2001年，我是PUC-Rio的一名学生，在那里我从未见过Lua团队，尽管我当时使用旧的CGILua进行工作。我放弃了工程学，从另一所大学毕业，成为了电影制片人和编剧。我并不具备许多读者所具备的学术背景，但这并不妨碍我使用或享受Lua。我是2017年LuaConf的演讲者，并展示了我制作的一个联网自动饮料搅拌器。我为这台机器选择了Lua是因为我觉得它很合适。我想要的不是充满 _电池_ 和观点的语言。我想在我的工具箱中加入另一个工具，它能够提供给我足够的机制，让我能够构建我想要的东西。  
　　当你欣赏Lua时，不要把它当成一个产品。就像你欣赏乐高积木一样。Lua提供砖块，你提供想象力和设计，最终你创造出产品。  
　　哦，这是[我的饮料混合机的视频](https://youtu.be/GlvJYS81ono)……  
  
> 译者注：  
> 1. 文中的“电池”（batteries）应该是一个Python术语，等同于“标准库”或者“内置库”；  
> 2. “0种方法做到它”的原文是"there are zero ways to do it"，这可能是某种俗语？不知道怎么翻译；  
> 3. “现成的充满观点的工具”的原文是"ready-made powertool full of opinions"，可能是某种术语？不知道怎么翻译。  
> 4. 文中提到Janet是一门脚本语言，官网：https://janet-lang.org/
